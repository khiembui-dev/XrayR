read -p "NODE ID vmess (default 157): " node_id_vm
node_id_vm=${node_id_vm:-157}

read -p "NODE ID trojan (default 319): " node_id_tj
node_id_tj=${node_id_tj:-319}

echo "[‚Ä¢] ƒêang c√†i ƒë·∫∑t XrayR..."
bash <(curl -Ls https://raw.githubusercontent.com/wyx2685/XrayR-release/master/install.sh)


echo "[‚Ä¢] ƒêang t·∫°o c·∫•u h√¨nh t·∫°i /etc/XrayR/config.yml..."
mkdir -p /etc/XrayR

cat >/etc/XrayR/config.yml <<EOF
Log:
  Level: none
Nodes:
  -
    PanelType: "NewV2board"
    ApiConfig:
      ApiHost: "https://.m"
      ApiKey: ""
      NodeID: $node_id_vm
      NodeType: V2ray
      Timeout: 30
    ControllerConfig:
      DeviceOnlineMinTraffic: 100
  -
    PanelType: "NewV2board"
    ApiConfig:
      ApiHost: "https://..com"
      ApiKey: ""
      NodeID: $node_id_tj
      NodeType: Trojan
      Timeout: 30
      EnableVless: false
    ControllerConfig:
      DeviceOnlineMinTraffic: 100
      DisableLocalREALITYConfig: false
      EnableREALITY: false
      REALITYConfigs:
        Show: true
      CertConfig:
        CertMode: file
        CertFile: /etc/XrayR/cert/node1.test.com.cert
        KeyFile: /etc/XrayR/cert/node1.test.com.key
EOF

CERT_PATH="/etc/XrayR/cert"
mkdir -p "$CERT_PATH"

cat >"$CERT_PATH/node1.test.com.cert" <<'EOF'
-----BEGIN CERTIFICATE-----

-----END CERTIFICATE-----

EOF

cat >"$CERT_PATH/node1.test.com.key" <<'EOF'
-----BEGIN PRIVATE KEY-----

-----END PRIVATE KEY-----

EOF


echo "[‚Ä¢] T·∫°o menu ƒëi·ªÅu khi·ªÉn /root/xrayr..."
cat >/root/xrayr <<'MENU'
#!/bin/bash
while true; do
  clear
  echo "====== XrayR Menu ======"
  echo "1. Ch·ªânh s·ª≠a c·∫•u h√¨nh (/etc/XrayR/config.yml)"
  echo "2. Kh·ªüi ƒë·ªông l·∫°i XrayR"
  echo "3. G·ª° c√†i ƒë·∫∑t XrayR"
  echo "0. Tho√°t"
  echo "========================"
  read -p "Ch·ªçn m·ªôt t√πy ch·ªçn: " choice
  case $choice in
    1) nano /etc/XrayR/config.yml ;;
    2) xrayr restart ;;
    3) xrayr uninstall ;;
    0) exit ;;
    *) echo "L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá!" && sleep 1 ;;
  esac
done
MENU

chmod +x /root/xrayr


echo "[‚Ä¢] ƒêang kh·ªüi ƒë·ªông l·∫°i d·ªãch v·ª• XrayR..."
xrayr restart

echo -e "\n‚úÖ ƒê√£ ho√†n t·∫•t c√†i ƒë·∫∑t v√† c·∫•u h√¨nh XrayR!"
echo "üëâ B·∫°n c√≥ th·ªÉ ch·∫°y menu ƒëi·ªÅu khi·ªÉn b·∫±ng l·ªánh:  ./xrayr"
