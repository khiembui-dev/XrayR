#!/bin/bash

clear
echo "========== C√ÄI ƒê·∫∂T XRAYR =========="
echo "1. Vmess"
echo "2. Trojan"
echo "3. Shadowsocks"
echo "==================================="
read -p "Ch·ªçn giao th·ª©c b·∫°n mu·ªën c√†i (1‚Äì3): " mode

case "$mode" in
1)
  node_type="V2ray"
  read -p "Nh·∫≠p Node ID cho Vmess: " node_id
  enable_vless="false"
  info="Vmess"
  ;;
2)
  node_type="Trojan"
  read -p "Nh·∫≠p Node ID cho Trojan: " node_id
  enable_vless="false"
  info="Trojan"
  ;;
3)
  node_type="Shadowsocks"
  read -p "Nh·∫≠p Node ID cho Shadowsocks: " node_id
  enable_vless="false"
  info="Shadowsocks"
  ;;
*)
  echo "‚ùå L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá. Tho√°t."
  exit 1
  ;;
esac

echo "[‚Ä¢] ƒêang c√†i ƒë·∫∑t XrayR..."
bash <(curl -Ls https://raw.githubusercontent.com/wyx2685/XrayR-release/master/install.sh)

mkdir -p /etc/XrayR
mkdir -p /etc/XrayR/cert

cat >/etc/XrayR/config.yml <<EOF
Log:
  Level: none
Nodes:
  -
    PanelType: "NewV2board"
    ApiConfig:
      ApiHost: "https://your-panel.com"
      ApiKey: "YOUR_API_KEY"
      NodeID: $node_id
      NodeType: $node_type
      Timeout: 30
      EnableVless: $enable_vless
    ControllerConfig:
      DeviceOnlineMinTraffic: 100
EOF

# Ch·ªâ th√™m ph·∫ßn TLS gi·∫£ n·∫øu l√† Trojan
if [[ "$node_type" == "Trojan" ]]; then
cat >>/etc/XrayR/config.yml <<EOF
      DisableLocalREALITYConfig: false
      EnableREALITY: false
      REALITYConfigs:
        Show: true
      CertConfig:
        CertMode: file
        CertFile: /etc/XrayR/cert/node.cert
        KeyFile: /etc/XrayR/cert/node.key
EOF

cat >/etc/XrayR/cert/node.cert <<EOF
-----BEGIN CERTIFICATE-----
MIIB...FAKECERT
-----END CERTIFICATE-----
EOF

cat >/etc/XrayR/cert/node.key <<EOF
-----BEGIN PRIVATE KEY-----
MIIE...FAKEKEY
-----END PRIVATE KEY-----
EOF
fi

cat >/root/xrayr <<'MENU'
#!/bin/bash
while true; do
  clear
  echo "====== XrayR Menu ======"
  echo "1. Ch·ªânh s·ª≠a c·∫•u h√¨nh (/etc/XrayR/config.yml)"
  echo "2. Kh·ªüi ƒë·ªông l·∫°i XrayR"
  echo "3. G·ª° c√†i ƒë·∫∑t XrayR"
  echo "0. Tho√°t"
  echo "========================"
  read -p "Ch·ªçn m·ªôt t√πy ch·ªçn: " choice
  case $choice in
    1) nano /etc/XrayR/config.yml ;;
    2) xrayr restart ;;
    3) xrayr uninstall ;;
    0) exit ;;
    *) echo "L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá!" && sleep 1 ;;
  esac
done
MENU

chmod +x /root/xrayr

echo "[‚Ä¢] ƒêang kh·ªüi ƒë·ªông l·∫°i d·ªãch v·ª• XrayR..."
xrayr restart

echo -e "\n‚úÖ ƒê√£ ho√†n t·∫•t c√†i ƒë·∫∑t giao th·ª©c $info!"
echo "üëâ B·∫°n c√≥ th·ªÉ ch·∫°y menu ƒëi·ªÅu khi·ªÉn b·∫±ng l·ªánh:  ./xrayr"
